<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥ç¦å¢™ - å¤æ—¦120å‘¨å¹´</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .wishes-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 20px;
        }

        .wishes-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .wishes-title {
            color: var(--fudan-blue);
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .wishes-subtitle {
            color: #666;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .wishes-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
        }

        @media (max-width: 1024px) {
            .wishes-content {
                grid-template-columns: 1fr;
            }
        }

        /* è¡¨å•æ ·å¼ */
        .wish-form {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: var(--card-shadow);
            position: sticky;
            top: 20px;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            color: var(--fudan-blue);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus {
            border-color: var(--fudan-red);
            outline: none;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .tag-option {
            padding: 0.5rem 1rem;
            border: 2px solid #eee;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tag-option:hover {
            border-color: var(--fudan-red);
            color: var(--fudan-red);
        }

        .tag-option.selected {
            background: var(--fudan-red);
            border-color: var(--fudan-red);
            color: white;
        }

        .submit-btn {
            width: 100%;
            padding: 1rem;
            background: var(--fudan-red);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background: var(--fudan-blue);
            transform: translateY(-2px);
        }

        /* ä¿®æ”¹ç¥ç¦å±•ç¤ºåŒºåŸŸæ ·å¼ */
        .wishes-display {
            position: relative;
            padding: 20px 0;
            margin: 0 auto;
            max-width: 1000px;
        }

        /* æ—¶é—´è½´ä¸­çº¿ */
        .wishes-display::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, var(--fudan-blue), var(--fudan-red));
            transform: translateX(-50%);
            border-radius: 2px;
        }

        /* ç¥ç¦å¡ç‰‡æ–°æ ·å¼ */
        .wish-card {
            position: relative;
            width: calc(50% - 30px);
            margin: 30px 0;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            animation: slideIn 0.5s ease-out;
        }

        /* å·¦å³äº¤é”™å¸ƒå±€ */
        .wish-card:nth-child(odd) {
            float: left;
            clear: both;
        }

        .wish-card:nth-child(even) {
            float: right;
            clear: both;
        }

        /* è¿æ¥çº¿ */
        .wish-card::before {
            content: '';
            position: absolute;
            top: 20px;
            width: 20px;
            height: 4px;
            background: var(--fudan-red);
        }

        .wish-card:nth-child(odd)::before {
            right: -50px;
        }

        .wish-card:nth-child(even)::before {
            left: -50px;
        }

        /* æ—¶é—´ç‚¹è£…é¥° */
        .wish-card::after {
            content: '';
            position: absolute;
            top: 12px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 4px solid var(--fudan-red);
            box-shadow: 0 0 0 4px rgba(158, 31, 20, 0.2);
        }

        .wish-card:nth-child(odd)::after {
            right: -60px;
        }

        .wish-card:nth-child(even)::after {
            left: -60px;
        }

        /* å¡ç‰‡å†…å®¹æ ·å¼ä¼˜åŒ– */
        .wish-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .wish-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--fudan-blue), var(--fudan-red));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .wish-info {
            flex: 1;
        }

        .wish-author {
            font-size: 1.2rem;
            color: var(--fudan-blue);
            margin: 0 0 5px;
        }

        .wish-date {
            font-size: 0.9rem;
            color: #666;
        }

        .wish-tag {
            display: inline-block;
            padding: 5px 12px;
            background: linear-gradient(45deg, var(--fudan-blue), var(--fudan-red));
            color: white;
            border-radius: 15px;
            font-size: 0.9rem;
            margin: 10px 0;
        }

        .wish-content {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #333;
            margin: 15px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 10px;
        }

        .wish-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border: none;
            background: none;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 20px;
        }

        .action-btn:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--fudan-red);
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* å“åº”å¼å¸ƒå±€ */
        @media (max-width: 768px) {
            .wishes-display::before {
                left: 30px;
            }

            .wish-card {
                width: calc(100% - 60px);
                float: right;
                margin-left: 60px;
            }

            .wish-card::before {
                left: -30px;
                width: 30px;
            }

            .wish-card::after {
                left: -40px;
            }

            .wish-card:nth-child(odd)::before,
            .wish-card:nth-child(even)::before {
                left: -30px;
            }

            .wish-card:nth-child(odd)::after,
            .wish-card:nth-child(even)::after {
                left: -40px;
            }
        }

        /* æ¸…é™¤æµ®åŠ¨ */
        .wishes-display::after {
            content: '';
            display: table;
            clear: both;
        }

        /* å¼¹å¹•åŒºåŸŸ */
        .danmaku-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 100vh;
            pointer-events: none;
            z-index: 1000;
        }

        .danmaku {
            position: absolute;
            white-space: nowrap;
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 20px;
            animation: danmaku-move 15s linear;
        }

        .danmaku .author {
            color: var(--fudan-red);
            font-weight: bold;
            margin-right: 8px;
        }

        @keyframes danmaku-move {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(-100%);
            }
        }

        /* åˆ†äº«å¼¹çª— */
        .share-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .share-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .share-preview {
            margin: 1.5rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .share-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .share-btn.primary {
            background: var(--fudan-red);
            color: white;
        }

        .share-btn.secondary {
            background: #f8f9fa;
            color: #333;
        }

        .share-btn:hover {
            transform: translateY(-2px);
        }

        .user-menu {
            position: relative;
            margin-left: 1rem;
        }

        .user-dropdown {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .user-dropdown:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
        }

        .user-identity {
            font-size: 0.8rem;
            padding: 0.2rem 0.5rem;
            background: var(--fudan-red);
            border-radius: 10px;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: white;
            min-width: 200px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            margin-top: 0.5rem;
            z-index: 1000;
        }

        .user-dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown-content a {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.8rem 1rem;
            color: #333;
            text-decoration: none;
            transition: all 0.3s;
        }

        .dropdown-content a:hover {
            background: #f8f9fa;
            color: var(--fudan-red);
        }

        .my-wishes-section {
            display: none;
            margin-top: 2rem;
            padding: 2rem;
            background: white;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
        }

        .section-header {
            margin-bottom: 2rem;
            padding: 1rem;
            background: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
        }

        .section-filters {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-label {
            color: var(--fudan-blue);
            font-weight: 500;
        }

        .filter-select {
            padding: 0.5rem;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .filter-select:focus {
            border-color: var(--fudan-red);
            outline: none;
        }

        .section-stats {
            display: flex;
            justify-content: flex-end;
            color: #666;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .wish-card.highlight {
            border: 2px solid var(--fudan-red);
            animation: highlight-pulse 2s infinite;
        }

        @keyframes highlight-pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(220, 53, 69, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
            }
        }

        .wish-card .special-effect {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 1;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--fudan-red);
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100%) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .comment-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }

        .comment-list {
            margin-top: 0.5rem;
        }

        .comment-item {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .comment-author {
            font-weight: 500;
            color: var(--fudan-blue);
        }

        .comment-form {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .comment-input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #eee;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .comment-submit {
            padding: 0.5rem 1rem;
            background: var(--fudan-red);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        /* è¿”å›æŒ‰é’®æ ·å¼ */
        .back-to-directory {
            position: fixed;
            top: 60px;
            left: 20px;
            z-index: 1000;
            background-color: var(--fudan-blue);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .back-to-directory:hover {
            background-color: #152d6f;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .back-to-directory i {
            margin-right: 8px;
        }

        @media (max-width: 768px) {
            .back-to-directory {
                padding: 6px 12px;
                font-size: 14px;
                top: 50px;
                left: 10px;
            }
        }

        /* éŸ³ä¹æ§åˆ¶æŒ‰é’® */
        .music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .music-control:hover {
            background: rgba(255, 255, 255, 1);
        }

        .music-icon {
            width: 24px;
            height: 24px;
        }

        .music-wave {
            fill: var(--fudan-red);
        }

        .music-note {
            fill: var(--fudan-red);
        }

        .music-control.playing .music-wave {
            fill: var(--fudan-blue);
        }

        .music-control.playing .music-note {
            fill: var(--fudan-blue);
        }

        /* éŸ³ä¹æç¤ºæ ·å¼ */
        .music-tooltip {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: white;
            color: var(--fudan-blue);
            padding: 12px 20px;
            border-radius: 15px;
            font-size: 15px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 1000;
            box-shadow: var(--card-shadow);
            border: 2px solid rgba(30, 58, 138, 0.1);
        }

        .music-tooltip.show {
            opacity: 1;
            transform: translateY(0);
        }

        .music-tooltip::before {
            content: '';
            position: absolute;
            bottom: -12px;
            right: 20px;
            width: 20px;
            height: 20px;
            background: white;
            transform: rotate(45deg);
            border-right: 2px solid rgba(30, 58, 138, 0.1);
            border-bottom: 2px solid rgba(30, 58, 138, 0.1);
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.05);
        }

        .music-tooltip::after {
            content: 'ğŸµ';
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
        }

        @media (max-width: 768px) {
            .music-tooltip {
                bottom: 70px;
                right: 10px;
                padding: 10px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="top-navbar">
        <a href="index.html" class="site-logo">
            <i class="fas fa-university"></i> å¤æ—¦120å‘¨å¹´
        </a>
        <div class="nav-links">
            <a href="index.html"><i class="fas fa-home"></i> é¦–é¡µ</a>
            <a href="directory.html"><i class="fas fa-list"></i> å†…å®¹ç›®å½•</a>
            <a href="timeline.html"><i class="fas fa-history"></i> å†å²æ—¶é—´è½´</a>
            <a href="achievements.html"><i class="fas fa-award"></i> æˆå°±å±•ç¤º</a>
            <div class="user-menu" id="userMenu">
                <div class="user-dropdown">
                    <span class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="userName">è®¿å®¢</span>
                    </span>
                </div>
            </div>
        </div>
    </nav>

    <div class="wishes-container">
        <div class="wishes-header">
            <h1 class="wishes-title">ç¥ç¦å¢™</h1>
            <p class="wishes-subtitle">
                åœ¨è¿™é‡Œç•™ä¸‹æ‚¨å¯¹æ¯æ ¡çš„ç¥ç¦ä¸æœŸæœ›ï¼Œä¸å…¨çƒå¤æ—¦äººå…±åŒåº†ç¥120å‘¨å¹´æ ¡åº†ã€‚
                æ¯ä¸€æ¡ç¥ç¦éƒ½å°†æˆä¸ºå¤æ—¦å†å²é•¿æ²³ä¸­çš„ä¸€é¢—ç’€ç’¨æ˜Ÿè¾°ã€‚
            </p>
        </div>

        <div class="wishes-content">
            <!-- ç¥ç¦è¡¨å• -->
            <div class="wish-form">
                <div class="form-group">
                    <label class="form-label">æ‚¨çš„ç§°å‘¼</label>
                    <input type="text" class="form-input" id="wishAuthor" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“åæˆ–æ˜µç§°ï¼ˆé€‰å¡«ï¼‰">
                </div>

                <div class="form-group">
                    <label class="form-label">é€‰æ‹©ä¸»é¢˜æ ‡ç­¾</label>
                    <div class="tags-container">
                        <div class="tag-option" data-tag="å…‰åå²æœˆ">å…‰åå²æœˆ</div>
                        <div class="tag-option" data-tag="ç›¸è¾‰é•¿å­˜">ç›¸è¾‰é•¿å­˜</div>
                        <div class="tag-option" data-tag="æ¡ƒæå¤©ä¸‹">æ¡ƒæå¤©ä¸‹</div>
                        <div class="tag-option" data-tag="è¿½å¿†å¾€æ˜”">è¿½å¿†å¾€æ˜”</div>
                        <div class="tag-option" data-tag="å±•æœ›æœªæ¥">å±•æœ›æœªæ¥</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ç¥ç¦å†…å®¹</label>
                    <textarea class="form-input form-textarea" id="wishContent" placeholder="å†™ä¸‹æ‚¨å¯¹æ¯æ ¡çš„ç¥ç¦"></textarea>
                </div>

                <button class="submit-btn" onclick="submitWish()">
                    <i class="fas fa-paper-plane"></i> å‘é€ç¥ç¦
                </button>
            </div>

            <!-- ç¥ç¦å±•ç¤ºåŒº -->
            <div class="wishes-section">
                <div class="section-header">
                    <div class="section-filters">
                        <div class="filter-group">
                            <label class="filter-label">æ’åºæ–¹å¼</label>
                            <select class="filter-select" id="sortSelect">
                                <option value="latest">æœ€æ–°å‘å¸ƒ</option>
                                <option value="popular">æœ€å—æ¬¢è¿</option>
                                <option value="friends">å¥½å‹ç¥ç¦</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">ç­›é€‰æ ‡ç­¾</label>
                            <select class="filter-select" id="tagSelect">
                                <option value="all">å…¨éƒ¨æ ‡ç­¾</option>
                                <option value="å…‰åå²æœˆ">å…‰åå²æœˆ</option>
                                <option value="ç›¸è¾‰é•¿å­˜">ç›¸è¾‰é•¿å­˜</option>
                                <option value="æ¡ƒæå¤©ä¸‹">æ¡ƒæå¤©ä¸‹</option>
                                <option value="è¿½å¿†å¾€æ˜”">è¿½å¿†å¾€æ˜”</option>
                                <option value="å±•æœ›æœªæ¥">å±•æœ›æœªæ¥</option>
                            </select>
                        </div>
                    </div>
                    <div class="section-stats">
                        <span class="stat-item">
                            <i class="fas fa-heart"></i>
                            ä»Šæ—¥å‰©ä½™ç‚¹èµæ¬¡æ•°ï¼š<span id="remainingLikes">10</span>
                        </span>
                    </div>
                </div>
                <div class="wishes-display" id="wishesDisplay">
                    <!-- ç¥ç¦å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- å¼¹å¹•å®¹å™¨ -->
    <div class="danmaku-container" id="danmakuContainer"></div>

    <!-- åˆ†äº«å¼¹çª— -->
    <div class="share-modal" id="shareModal">
        <div class="share-content">
            <h2>åˆ†äº«æ‚¨çš„ç¥ç¦</h2>
            <div class="share-preview" id="sharePreview">
                <!-- é¢„è§ˆå†…å®¹å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
            </div>
            <div class="share-buttons">
                <button class="share-btn primary" onclick="shareToWeChat()">
                    <i class="fab fa-weixin"></i> åˆ†äº«åˆ°å¾®ä¿¡
                </button>
                <button class="share-btn secondary" onclick="closeShareModal()">
                    <i class="fas fa-times"></i> å…³é—­
                </button>
            </div>
        </div>
    </div>

    <a href="directory.html" class="back-to-directory">
        <i class="fas fa-home"></i> è¿”å›ç›®å½•
    </a>

    <!-- éŸ³ä¹æç¤ºå…ƒç´  -->
    <div class="music-tooltip" id="musicTooltip">ç‚¹å‡»æ’­æ”¾èƒŒæ™¯éŸ³ä¹</div>
    
    <!-- éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
    <div class="music-control">
        <svg class="music-icon" viewBox="0 0 24 24">
            <path class="music-wave" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
            <path class="music-note" d="M12.5 7v4.27c-.44-.35-1-0.57-1.6-0.57-1.38 0-2.5 1.12-2.5 2.5s1.12 2.5 2.5 2.5 2.5-1.12 2.5-2.5V9h2V7h-2.5z"/>
        </svg>
    </div>

    <script>
        // ç¤ºä¾‹ç¥ç¦æ•°æ®
        const wishes = [
            {
                author: "å¤æ—¦æ ¡å‹",
                content: "æ„¿æ¯æ ¡æ¡ƒæèŠ¬èŠ³ï¼Œå…‰è¾‰å†ä¹…å¼¥æ–°ã€‚åœ¨æ–°çš„ç™¾å¹´å¾ç¨‹ä¸­ï¼Œç»§ç»­åŸ¹è‚²æ ‹æ¢ä¹‹æ‰ï¼Œä¸ºå›½å®¶å‘å±•è´¡çŒ®åŠ›é‡ï¼",
                tag: "å…‰åå²æœˆ",
                date: "2024-03-15",
                likes: 128
            },
            {
                author: "å¼ æ˜",
                content: "å¿†å¾€æ˜”ç›¸è¾‰å ‚å‰çš„ç‚¹ç‚¹æ»´æ»´ï¼Œæ„¿æ¯æ ¡ç»§å¾€å¼€æ¥ï¼Œå†åˆ›è¾‰ç…Œã€‚ç¥ç¦å¤æ—¦120å‘¨å¹´ç”Ÿæ—¥å¿«ä¹ï¼",
                tag: "è¿½å¿†å¾€æ˜”",
                date: "2024-03-14",
                likes: 96
            },
            {
                author: "æå",
                content: "åœ¨å¤æ—¦çš„æ±‚å­¦å²æœˆæ˜¯äººç”Ÿæœ€ç¾å¥½çš„å›å¿†ï¼Œç¥æ„¿æ¯æ ¡ç»§ç»­å¼•é¢†æ•™è‚²åˆ›æ–°ï¼ŒåŸ¹å…»æ›´å¤šä¼˜ç§€äººæ‰ï¼",
                tag: "æ¡ƒæå¤©ä¸‹",
                date: "2024-03-13",
                likes: 85
            }
        ];

        // ç”¨æˆ·ç®¡ç†ç›¸å…³åŠŸèƒ½
        const userState = {
            isLoggedIn: true,
            userData: {
                name: 'è®¿å®¢'
            }
        };

        // æ›´æ–°ç”¨æˆ·ç•Œé¢
        function updateUserInterface() {
            const userName = document.getElementById('userName');
            userName.textContent = userState.userData.name;
        }

        // æ£€æŸ¥æ¯æ—¥ç‚¹èµæ¬¡æ•°
        function checkDailyLikes() {
            const today = new Date().toDateString();
            if (userState.dailyLikes.date !== today) {
                userState.dailyLikes.date = today;
                userState.dailyLikes.count = 0;
            }
            document.getElementById('remainingLikes').textContent = 
                userState.dailyLikes.max - userState.dailyLikes.count;
        }

        // æäº¤ç¥ç¦å‰æ£€æŸ¥
        function canSubmitWish() {
            if (!userState.isLoggedIn) {
                alert('è¯·å…ˆç™»å½•åå†å‘è¡¨ç¥ç¦');
                redirectToLogin();
                return false;
            }

            const lastWishTime = localStorage.getItem(`lastWishTime_${userState.userData.name}`);
            if (lastWishTime) {
                const timeDiff = Date.now() - parseInt(lastWishTime);
                if (timeDiff < 24 * 60 * 60 * 1000) { // 24å°æ—¶å†…
                    alert('æ¯ä½ç”¨æˆ·æ¯å¤©åªèƒ½å‘è¡¨ä¸€æ¡ç¥ç¦');
                    return false;
                }
            }

            return true;
        }

        // ä¿®æ”¹æäº¤ç¥ç¦å‡½æ•°
        function submitWish() {
            if (!canSubmitWish()) return;

            const author = userState.userData.name;
            const content = document.getElementById('wishContent').value;
            const selectedTag = document.querySelector('.tag-option.selected');
            
            if (!content) {
                alert('è¯·è¾“å…¥ç¥ç¦å†…å®¹ï¼');
                return;
            }

            if (!selectedTag) {
                alert('è¯·é€‰æ‹©ä¸€ä¸ªä¸»é¢˜æ ‡ç­¾ï¼');
                return;
            }

            const newWish = {
                id: Date.now(),
                author,
                content,
                tag: selectedTag.dataset.tag,
                date: new Date().toISOString().split('T')[0],
                likes: 0,
                identity: userState.userData.identity
            };

            wishes.unshift(newWish);
            localStorage.setItem(`lastWishTime_${author}`, Date.now().toString());
            renderWishes();
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('wishContent').value = '';
            selectedTag.classList.remove('selected');

            // æ·»åŠ åˆ°å¼¹å¹•
            addDanmaku(content);
        }

        // ä¿®æ”¹ç‚¹èµåŠŸèƒ½
        function likeWish(btn) {
            if (!userState.isLoggedIn) {
                alert('è¯·å…ˆç™»å½•åå†ç‚¹èµ');
                redirectToLogin();
                return;
            }

            const today = new Date().toDateString();
            if (userState.dailyLikes.date !== today) {
                userState.dailyLikes.date = today;
                userState.dailyLikes.count = 0;
            }

            if (userState.dailyLikes.count >= userState.dailyLikes.max) {
                alert('æ‚¨ä»Šæ—¥çš„ç‚¹èµæ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œè¯·æ˜å¤©å†æ¥ï¼');
                return;
            }

            const wishCard = btn.closest('.wish-card');
            const wishId = wishCard.dataset.wishId;
            const likedBy = JSON.parse(localStorage.getItem(`wish_${wishId}_likes`) || '[]');
            const likeCount = btn.querySelector('span');
            const icon = btn.querySelector('i');

            if (likedBy.includes(userState.userData.name)) {
                // å–æ¶ˆç‚¹èµ
                const index = likedBy.indexOf(userState.userData.name);
                likedBy.splice(index, 1);
                icon.classList.replace('fas', 'far');
                icon.style.color = '';
                likeCount.textContent = parseInt(likeCount.textContent) - 1;
                userState.dailyLikes.count--;
            } else {
                // æ·»åŠ ç‚¹èµ
                likedBy.push(userState.userData.name);
                icon.classList.replace('far', 'fas');
                icon.style.color = 'var(--fudan-red)';
                likeCount.textContent = parseInt(likeCount.textContent) + 1;
                userState.dailyLikes.count++;

                // æ£€æŸ¥æ˜¯å¦è§¦å‘ç‰¹æ•ˆ
                const likes = parseInt(likeCount.textContent);
                if (likes >= 50) {
                    triggerSpecialEffect(wishCard);
                }
            }

            localStorage.setItem(`wish_${wishId}_likes`, JSON.stringify(likedBy));
            checkDailyLikes();
        }

        // ç‰¹æ•ˆå±•ç¤º
        function triggerSpecialEffect(wishCard) {
            // æ·»åŠ é«˜äº®æ•ˆæœ
            wishCard.classList.add('highlight');
            
            // åˆ›å»ºå½©å¸¦æ•ˆæœ
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 50%)`;
                wishCard.appendChild(confetti);
                
                confetti.addEventListener('animationend', () => {
                    wishCard.removeChild(confetti);
                });
            }
        }

        // æ’åºå’Œç­›é€‰
        document.getElementById('sortSelect').addEventListener('change', (e) => {
            const sortBy = e.target.value;
            let sortedWishes = [...wishes];
            
            switch (sortBy) {
                case 'latest':
                    sortedWishes.sort((a, b) => new Date(b.date) - new Date(a.date));
                    break;
                case 'popular':
                    sortedWishes.sort((a, b) => b.likes - a.likes);
                    break;
                case 'friends':
                    // è¿™é‡Œå¯ä»¥æ·»åŠ å¥½å‹ç³»ç»Ÿçš„é€»è¾‘
                    sortedWishes = sortedWishes.filter(wish => 
                        userState.userData?.friends?.includes(wish.author));
                    break;
            }
            
            renderWishes(sortedWishes);
        });

        document.getElementById('tagSelect').addEventListener('change', (e) => {
            const selectedTag = e.target.value;
            const filteredWishes = selectedTag === 'all' 
                ? wishes 
                : wishes.filter(wish => wish.tag === selectedTag);
            renderWishes(filteredWishes);
        });

        // è¯„è®ºåŠŸèƒ½
        function addComment(wishId, content) {
            if (!userState.isLoggedIn) {
                alert('è¯·å…ˆç™»å½•åå†è¯„è®º');
                redirectToLogin();
                return;
            }

            const comments = JSON.parse(localStorage.getItem(`wish_${wishId}_comments`) || '[]');
            const newComment = {
                author: userState.userData.name,
                content: content,
                date: new Date().toISOString(),
                status: 'pending' // pending, approved, rejected
            };
            
            comments.push(newComment);
            localStorage.setItem(`wish_${wishId}_comments`, JSON.stringify(comments));
            
            // åˆ·æ–°è¯„è®ºæ˜¾ç¤º
            renderComments(wishId);
        }

        function renderComments(wishId) {
            const comments = JSON.parse(localStorage.getItem(`wish_${wishId}_comments`) || '[]');
            const approvedComments = comments.filter(comment => comment.status === 'approved');
            
            const commentList = document.querySelector(`#wish-${wishId} .comment-list`);
            commentList.innerHTML = approvedComments.map(comment => `
                <div class="comment-item">
                    <span class="comment-author">${comment.author}:</span>
                    <span class="comment-content">${comment.content}</span>
                </div>
            `).join('');
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', () => {
            // æ¸²æŸ“ç¥ç¦å¡ç‰‡
            renderWishes();
            // åˆå§‹åŒ–æ ‡ç­¾é€‰æ‹©
            initTagSelection();
            // å¯åŠ¨å¼¹å¹•
            startDanmaku();
            // æ›´æ–°ç”¨æˆ·ç•Œé¢
            updateUserInterface();
            checkDailyLikes();
        });

        // æ¸²æŸ“ç¥ç¦å¡ç‰‡
        function renderWishes() {
            const container = document.getElementById('wishesDisplay');
            container.innerHTML = wishes.map(wish => `
                <div class="wish-card">
                    <div class="wish-header">
                        <div class="wish-avatar">
                            ${wish.author.charAt(0)}
                        </div>
                        <div class="wish-info">
                            <h3 class="wish-author">${wish.author}</h3>
                            <div class="wish-date">${wish.date}</div>
                        </div>
                    </div>
                    <div class="wish-tag">${wish.tag}</div>
                    <p class="wish-content">${wish.content}</p>
                    <div class="wish-actions">
                        <button class="action-btn" onclick="likeWish(this)">
                            <i class="far fa-heart"></i>
                            <span>${wish.likes}</span>
                        </button>
                        <button class="action-btn" onclick="shareWish(this)">
                            <i class="fas fa-share-alt"></i>
                            åˆ†äº«
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // åˆå§‹åŒ–æ ‡ç­¾é€‰æ‹©
        function initTagSelection() {
            const tags = document.querySelectorAll('.tag-option');
            tags.forEach(tag => {
                tag.addEventListener('click', () => {
                    tags.forEach(t => t.classList.remove('selected'));
                    tag.classList.add('selected');
                });
            });
        }

        // åˆ†äº«åŠŸèƒ½
        function shareWish(btn) {
            const wishCard = btn.closest('.wish-card');
            const content = wishCard.querySelector('.wish-content').textContent;
            const author = wishCard.querySelector('.wish-author').textContent;
            
            const shareModal = document.getElementById('shareModal');
            const sharePreview = document.getElementById('sharePreview');
            
            sharePreview.innerHTML = `
                <p><strong>${author}çš„ç¥ç¦ï¼š</strong></p>
                <p>${content}</p>
            `;
            
            shareModal.style.display = 'flex';
        }

        function closeShareModal() {
            document.getElementById('shareModal').style.display = 'none';
        }

        function shareToWeChat() {
            alert('è¯·æˆªå›¾åˆ†äº«åˆ°å¾®ä¿¡');
        }

        // å¼¹å¹•åŠŸèƒ½
        function startDanmaku() {
            wishes.forEach(wish => {
                setTimeout(() => {
                    const content = `<span class="author">${wish.author}</span>${wish.content}`;
                    addDanmaku(content);
                }, Math.random() * 5000);
            });
        }

        function addDanmaku(content) {
            const container = document.getElementById('danmakuContainer');
            const danmaku = document.createElement('div');
            danmaku.className = 'danmaku';
            danmaku.innerHTML = content;  // ä½¿ç”¨ innerHTML æ¥æ”¯æŒå¸¦æ ·å¼çš„å†…å®¹
            danmaku.style.top = Math.random() * 70 + 15 + '%';
            container.appendChild(danmaku);
            
            danmaku.addEventListener('animationend', () => {
                container.removeChild(danmaku);
            });
        }

        class AudioController {
            constructor() {
                this.audio = new Audio('assets/audio/wishes.mp3');
                this.audio.loop = true;
                this.isPlaying = false;
                this.currentVolume = 0.5;
                this.muted = true;
                this.firstPlay = true;

                this.initializeEventListeners();
                this.loadPlaybackState();
                this.showMusicTooltip();
                console.log('Audio controller initialized');
            }

            showMusicTooltip() {
                const tooltip = document.getElementById('musicTooltip');
                if (tooltip && this.firstPlay) {
                    tooltip.classList.add('show');
                    
                    // 3ç§’åè‡ªåŠ¨éšè—æç¤º
                    setTimeout(() => {
                        tooltip.classList.remove('show');
                    }, 3000);

                    // ç‚¹å‡»éŸ³ä¹æ§åˆ¶æŒ‰é’®åéšè—æç¤º
                    const musicControl = document.querySelector('.music-control');
                    if (musicControl) {
                        musicControl.addEventListener('click', () => {
                            tooltip.classList.remove('show');
                        }, { once: true });
                    }
                }
            }

            initializeEventListeners() {
                const musicControl = document.querySelector('.music-control');
                if (musicControl) {
                    musicControl.addEventListener('click', () => this.togglePlayback());
                }

                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        if (this.isPlaying) {
                            this.audio.pause();
                        }
                    } else {
                        if (this.isPlaying && !this.firstPlay) {
                            this.audio.play();
                        }
                    }
                });

                // ç”¨æˆ·äº¤äº’æ—¶å¼€å§‹æ’­æ”¾
                const startPlayback = () => {
                    if (this.firstPlay) {
                        this.firstPlay = false;
                        this.startPlayWithFadeIn();
                    }
                };

                ['click', 'touchstart', 'keydown', 'scroll'].forEach(event => {
                    document.addEventListener(event, startPlayback, { once: true });
                });

                // éŸ³é¢‘äº‹ä»¶ç›‘å¬
                this.audio.addEventListener('play', () => {
                    musicControl?.classList.add('playing');
                    this.isPlaying = true;
                    this.savePlaybackState();
                });

                this.audio.addEventListener('pause', () => {
                    musicControl?.classList.remove('playing');
                    this.isPlaying = false;
                    this.savePlaybackState();
                });
            }

            startPlayWithFadeIn() {
                this.audio.volume = 0;
                this.audio.play().then(() => {
                    let vol = 0;
                    const fadeIn = setInterval(() => {
                        if (vol < this.currentVolume) {
                            vol += 0.1;
                            this.audio.volume = vol;
                        } else {
                            clearInterval(fadeIn);
                        }
                    }, 200);
                }).catch(error => {
                    console.error('æ’­æ”¾å¤±è´¥:', error);
                });
            }

            togglePlayback() {
                if (this.firstPlay) {
                    this.firstPlay = false;
                    this.startPlayWithFadeIn();
                } else if (this.isPlaying) {
                    this.audio.pause();
                } else {
                    this.audio.play();
                }
            }

            savePlaybackState() {
                localStorage.setItem('audioPlaybackState', JSON.stringify({
                    isPlaying: this.isPlaying,
                    currentVolume: this.currentVolume
                }));
            }

            loadPlaybackState() {
                const savedState = localStorage.getItem('audioPlaybackState');
                if (savedState) {
                    const { isPlaying, currentVolume } = JSON.parse(savedState);
                    this.currentVolume = currentVolume;
                    this.audio.volume = this.currentVolume;
                }
            }
        }

        // åˆå§‹åŒ–éŸ³é¢‘æ§åˆ¶å™¨
        const audioController = new AudioController();
    </script>
</body>
</html> 